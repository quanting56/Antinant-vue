import{p as nt,Q as U,u as H,E as O}from"./transform-DNQUPihx.js";import{s as R}from"./select-1EGbaqqT.js";import{p as G}from"./pointer-BV9FWJ6s.js";import{d as ot,y as it}from"./nodrag-CZbKbhqk.js";var ut=1e-12;function L(n){return((n=Math.exp(n))+1/n)/2}function rt(n){return((n=Math.exp(n))-1/n)/2}function at(n){return((n=Math.exp(2*n))-1)/(n+1)}const st=function n(l,m,y){function v(p,h){var z=p[0],x=p[1],d=p[2],I=h[0],Q=h[1],w=h[2],P=I-z,K=Q-x,q=P*P+K*K,S,u;if(q<ut)u=Math.log(w/d)/l,S=function(B){return[z+B*P,x+B*K,d*Math.exp(l*B*u)]};else{var V=Math.sqrt(q),k=(w*w-d*d+y*q)/(2*d*m*V),X=(w*w-d*d-y*q)/(2*w*m*V),Y=Math.log(Math.sqrt(k*k+1)-k),_=Math.log(Math.sqrt(X*X+1)-X);u=(_-Y)/l,S=function(B){var Z=B*u,j=L(Y),A=d/(m*V)*(j*at(l*Z+Y)-rt(Y));return[z+A*P,x+A*K,d*j/L(l*Z+Y)]}}return S.duration=u*1e3*l/Math.SQRT2,S}return v.rho=function(p){var h=Math.max(.001,+p),z=h*h,x=z*z;return n(h,z,x)},v}(Math.SQRT2,2,4),C=n=>()=>n;function ht(n,{sourceEvent:l,target:m,transform:y,dispatch:v}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:l,enumerable:!0,configurable:!0},target:{value:m,enumerable:!0,configurable:!0},transform:{value:y,enumerable:!0,configurable:!0},_:{value:v}})}function J(n){n.stopImmediatePropagation()}function W(n){n.preventDefault(),n.stopImmediatePropagation()}function ct(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function lt(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function N(){return this.__zoom||U}function ft(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function mt(){return navigator.maxTouchPoints||"ontouchstart"in this}function pt(n,l,m){var y=n.invertX(l[0][0])-m[0][0],v=n.invertX(l[1][0])-m[1][0],p=n.invertY(l[0][1])-m[0][1],h=n.invertY(l[1][1])-m[1][1];return n.translate(v>y?(y+v)/2:Math.min(0,y)||Math.max(0,v),h>p?(p+h)/2:Math.min(0,p)||Math.max(0,h))}function zt(){var n=ct,l=lt,m=pt,y=ft,v=mt,p=[0,1/0],h=[[-1/0,-1/0],[1/0,1/0]],z=250,x=st,d=nt("start","zoom","end"),I,Q,w,P=500,K=150,q=0,S=10;function u(t){t.property("__zoom",N).on("wheel.zoom",Z,{passive:!1}).on("mousedown.zoom",j).on("dblclick.zoom",A).filter(v).on("touchstart.zoom",$).on("touchmove.zoom",tt).on("touchend.zoom touchcancel.zoom",et).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.transform=function(t,o,e,i){var r=t.selection?t.selection():t;r.property("__zoom",N),t!==r?Y(t,o,e,i):r.interrupt().each(function(){_(this,arguments).event(i).start().zoom(null,typeof o=="function"?o.apply(this,arguments):o).end()})},u.scaleBy=function(t,o,e,i){u.scaleTo(t,function(){var r=this.__zoom.k,a=typeof o=="function"?o.apply(this,arguments):o;return r*a},e,i)},u.scaleTo=function(t,o,e,i){u.transform(t,function(){var r=l.apply(this,arguments),a=this.__zoom,s=e==null?X(r):typeof e=="function"?e.apply(this,arguments):e,c=a.invert(s),f=typeof o=="function"?o.apply(this,arguments):o;return m(k(V(a,f),s,c),r,h)},e,i)},u.translateBy=function(t,o,e,i){u.transform(t,function(){return m(this.__zoom.translate(typeof o=="function"?o.apply(this,arguments):o,typeof e=="function"?e.apply(this,arguments):e),l.apply(this,arguments),h)},null,i)},u.translateTo=function(t,o,e,i,r){u.transform(t,function(){var a=l.apply(this,arguments),s=this.__zoom,c=i==null?X(a):typeof i=="function"?i.apply(this,arguments):i;return m(U.translate(c[0],c[1]).scale(s.k).translate(typeof o=="function"?-o.apply(this,arguments):-o,typeof e=="function"?-e.apply(this,arguments):-e),a,h)},i,r)};function V(t,o){return o=Math.max(p[0],Math.min(p[1],o)),o===t.k?t:new H(o,t.x,t.y)}function k(t,o,e){var i=o[0]-e[0]*t.k,r=o[1]-e[1]*t.k;return i===t.x&&r===t.y?t:new H(t.k,i,r)}function X(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function Y(t,o,e,i){t.on("start.zoom",function(){_(this,arguments).event(i).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).event(i).end()}).tween("zoom",function(){var r=this,a=arguments,s=_(r,a).event(i),c=l.apply(r,a),f=e==null?X(c):typeof e=="function"?e.apply(r,a):e,b=Math.max(c[1][0]-c[0][0],c[1][1]-c[0][1]),g=r.__zoom,M=typeof o=="function"?o.apply(r,a):o,D=x(g.invert(f).concat(b/g.k),M.invert(f).concat(b/M.k));return function(T){if(T===1)T=M;else{var E=D(T),F=b/E[2];T=new H(F,f[0]-E[0]*F,f[1]-E[1]*F)}s.zoom(null,T)}})}function _(t,o,e){return!e&&t.__zooming||new B(t,o)}function B(t,o){this.that=t,this.args=o,this.active=0,this.sourceEvent=null,this.extent=l.apply(t,o),this.taps=0}B.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,o){return this.mouse&&t!=="mouse"&&(this.mouse[1]=o.invert(this.mouse[0])),this.touch0&&t!=="touch"&&(this.touch0[1]=o.invert(this.touch0[0])),this.touch1&&t!=="touch"&&(this.touch1[1]=o.invert(this.touch1[0])),this.that.__zoom=o,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var o=R(this.that).datum();d.call(t,this.that,new ht(t,{sourceEvent:this.sourceEvent,target:u,transform:this.that.__zoom,dispatch:d}),o)}};function Z(t,...o){if(!n.apply(this,arguments))return;var e=_(this,o).event(t),i=this.__zoom,r=Math.max(p[0],Math.min(p[1],i.k*Math.pow(2,y.apply(this,arguments)))),a=G(t);if(e.wheel)(e.mouse[0][0]!==a[0]||e.mouse[0][1]!==a[1])&&(e.mouse[1]=i.invert(e.mouse[0]=a)),clearTimeout(e.wheel);else{if(i.k===r)return;e.mouse=[a,i.invert(a)],O(this),e.start()}W(t),e.wheel=setTimeout(s,K),e.zoom("mouse",m(k(V(i,r),e.mouse[0],e.mouse[1]),e.extent,h));function s(){e.wheel=null,e.end()}}function j(t,...o){if(w||!n.apply(this,arguments))return;var e=t.currentTarget,i=_(this,o,!0).event(t),r=R(t.view).on("mousemove.zoom",f,!0).on("mouseup.zoom",b,!0),a=G(t,e),s=t.clientX,c=t.clientY;ot(t.view),J(t),i.mouse=[a,this.__zoom.invert(a)],O(this),i.start();function f(g){if(W(g),!i.moved){var M=g.clientX-s,D=g.clientY-c;i.moved=M*M+D*D>q}i.event(g).zoom("mouse",m(k(i.that.__zoom,i.mouse[0]=G(g,e),i.mouse[1]),i.extent,h))}function b(g){r.on("mousemove.zoom mouseup.zoom",null),it(g.view,i.moved),W(g),i.event(g).end()}}function A(t,...o){if(n.apply(this,arguments)){var e=this.__zoom,i=G(t.changedTouches?t.changedTouches[0]:t,this),r=e.invert(i),a=e.k*(t.shiftKey?.5:2),s=m(k(V(e,a),i,r),l.apply(this,o),h);W(t),z>0?R(this).transition().duration(z).call(Y,s,i,t):R(this).call(u.transform,s,i,t)}}function $(t,...o){if(n.apply(this,arguments)){var e=t.touches,i=e.length,r=_(this,o,t.changedTouches.length===i).event(t),a,s,c,f;for(J(t),s=0;s<i;++s)c=e[s],f=G(c,this),f=[f,this.__zoom.invert(f),c.identifier],r.touch0?!r.touch1&&r.touch0[2]!==f[2]&&(r.touch1=f,r.taps=0):(r.touch0=f,a=!0,r.taps=1+!!I);I&&(I=clearTimeout(I)),a&&(r.taps<2&&(Q=f[0],I=setTimeout(function(){I=null},P)),O(this),r.start())}}function tt(t,...o){if(this.__zooming){var e=_(this,o).event(t),i=t.changedTouches,r=i.length,a,s,c,f;for(W(t),a=0;a<r;++a)s=i[a],c=G(s,this),e.touch0&&e.touch0[2]===s.identifier?e.touch0[0]=c:e.touch1&&e.touch1[2]===s.identifier&&(e.touch1[0]=c);if(s=e.that.__zoom,e.touch1){var b=e.touch0[0],g=e.touch0[1],M=e.touch1[0],D=e.touch1[1],T=(T=M[0]-b[0])*T+(T=M[1]-b[1])*T,E=(E=D[0]-g[0])*E+(E=D[1]-g[1])*E;s=V(s,Math.sqrt(T/E)),c=[(b[0]+M[0])/2,(b[1]+M[1])/2],f=[(g[0]+D[0])/2,(g[1]+D[1])/2]}else if(e.touch0)c=e.touch0[0],f=e.touch0[1];else return;e.zoom("touch",m(k(s,c,f),e.extent,h))}}function et(t,...o){if(this.__zooming){var e=_(this,o).event(t),i=t.changedTouches,r=i.length,a,s;for(J(t),w&&clearTimeout(w),w=setTimeout(function(){w=null},P),a=0;a<r;++a)s=i[a],e.touch0&&e.touch0[2]===s.identifier?delete e.touch0:e.touch1&&e.touch1[2]===s.identifier&&delete e.touch1;if(e.touch1&&!e.touch0&&(e.touch0=e.touch1,delete e.touch1),e.touch0)e.touch0[1]=this.__zoom.invert(e.touch0[0]);else if(e.end(),e.taps===2&&(s=G(s,this),Math.hypot(Q[0]-s[0],Q[1]-s[1])<S)){var c=R(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return u.wheelDelta=function(t){return arguments.length?(y=typeof t=="function"?t:C(+t),u):y},u.filter=function(t){return arguments.length?(n=typeof t=="function"?t:C(!!t),u):n},u.touchable=function(t){return arguments.length?(v=typeof t=="function"?t:C(!!t),u):v},u.extent=function(t){return arguments.length?(l=typeof t=="function"?t:C([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),u):l},u.scaleExtent=function(t){return arguments.length?(p[0]=+t[0],p[1]=+t[1],u):[p[0],p[1]]},u.translateExtent=function(t){return arguments.length?(h[0][0]=+t[0][0],h[1][0]=+t[1][0],h[0][1]=+t[0][1],h[1][1]=+t[1][1],u):[[h[0][0],h[0][1]],[h[1][0],h[1][1]]]},u.constrain=function(t){return arguments.length?(m=t,u):m},u.duration=function(t){return arguments.length?(z=+t,u):z},u.interpolate=function(t){return arguments.length?(x=t,u):x},u.on=function(){var t=d.on.apply(d,arguments);return t===d?u:t},u.clickDistance=function(t){return arguments.length?(q=(t=+t)*t,u):Math.sqrt(q)},u.tapDistance=function(t){return arguments.length?(S=+t,u):S},u}export{st as i,zt as z};
